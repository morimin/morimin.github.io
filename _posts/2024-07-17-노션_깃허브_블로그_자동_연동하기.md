---
title: "[NOTION] ë…¸ì…˜ ê¹ƒí—ˆë¸Œ ë¸”ë¡œê·¸ ìë™ ì—°ë™í•˜ê¸°"
excerpt: ""
header: ""

categories:
    - 
tags:
    - [IT-ETC, ê¹ƒí—ˆë¸Œ ë¸”ë¡œê·¸, ê¹ƒí—ˆë¸Œë¸”ë¡œê·¸, ë…¸ì…˜, ë…¸ì…˜API, ë…¸ì…˜ API ì—°ë™, ë…¸ì…˜ ë°ì´í„°ë² ì´ìŠ¤ API ì—°ë™, Github Actions, ê¹ƒí—ˆë¸Œ ë…¸ì…˜ ì—°ë™í•˜ê¸°, ë…¸ì…˜ ê¹ƒí—ˆë¸Œ ì—°ë™, how to automate uploading notion page to github post, ]
last_modified_at: 2024-07-17
---
<br><br>

â€» ë³¸ í¬ìŠ¤íŒ…ì€ lourcode ë‹˜ì˜ ê¸€ì„ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.(ì›ë³¸ë§í¬ : [https://lourcode.kr/posts/Jekyll-ê¸°ë°˜-Github-Pagesì™€-Notion-Page-ì—°ë™/](https://lourcode.kr/posts/Jekyll-%EA%B8%B0%EB%B0%98-Github-Pages%EC%99%80-Notion-Page-%EC%97%B0%EB%8F%99/))



### 1. API í‚¤ ì„¤ì •


   1-1. ì•„ë˜ ì£¼ì†Œ í´ë¦­


Â           [https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)


   1-2. ìƒˆ API í†µí•© í´ë¦­


![0](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/0.png)


   1-3. ì—°ê²°ëœ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ í™•ì¸í•˜ê³  ì´ë¦„ì„ ë§Œë“¤ì–´ì£¼ê³  â€˜ì œì¶œâ€™ ë²„íŠ¼ í´ë¦­


![1](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/1.png)


   1-4. ì‹œí¬ë¦¿í‚¤ê°€ ìƒì„±ë˜ë©´ í‘œì‹œ â†’ ë³µì‚¬ ë¥¼ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì—¬ í‚¤ê°’ì„ ë³µì‚¬í•œë‹¤.


![2](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/2.png)


â€» ì‹œí¬ë¦¿í‚¤ê°’ì€ secret_* ì˜ í˜•íƒœë¡œ ë˜ì–´ìˆë‹¤.


 



## 2. ë…¸ì…˜ì—ì„œ ì‚¬ìš©/ì—°ë™ í•  ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±


   2-1. ì•„ë˜ì™€ ê°™ì´ ìƒ˜í”Œìš©ìœ¼ë¡œ ë§Œë“¤ì–´ë³¸ë‹¤.(ê³µìœ ë§í¬ : [https://asteriskos.notion.site/Blog-DB-85109cf911b74a62a5041f6047d5792d?pvs=4](https://asteriskos.notion.site/Blog-DB-85109cf911b74a62a5041f6047d5792d))


![3](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/3.png)


   2-2. í…Œì´ë¸”ì— ë§ˆìš°ìŠ¤ë¥¼ ê°€ì ¸ê°€ ë˜ë©´ ì˜†ì— ë”ë³´ê¸°(::)ê°€ í‘œì‹œë˜ëŠ”ë° í´ë¦­í•œë‹¤.


![4](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/4.png)


   2-3. ë§í¬ë³µì‚¬ë¥¼ ëˆ„ë¥¸ë‹¤


https://www.notion.so/asteriskos/de2dcf74aff44030954dbd4d991c559b?v=1f7e542c866341c1a8d68c9c328c3faf&pvs=4


í‘œì‹œí•œ ë¶€ë¶„ì´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ID ì´ë‹¤. ê¸°ì–µí•´ë‘”ë‹¤.



## 3. ë°ì´í„°ë² ì´ìŠ¤ í˜ì´ì§€ì— APIì—°ë™


   3-1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±í•œ í˜ì´ì§€ ìš°ì¸¡ìƒë‹¨ì—  ë”ë³´ê¸°(â€¦) ë¥¼ í´ë¦­í•˜ì—¬ APIë¥¼ ì—°ë™í•œë‹¤.


![5](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/5.png)


   3-2. ì—°ê²°í• ê±°ëƒëŠ” íŒì—…ì´ëœ¨ëŠ”ë°, â€˜í™•ì¸â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—°ê²°ë¨ì„ í™•ì¸í•˜ì.


![6](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/6.png)


![7](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/7.png)



## 4. ê¹ƒí—ˆë¸Œ íŒŒì¼ ì„¤ì •


   4-1. Settings â†’ Secrets and variables â†’ Actions ë¥¼ ëˆŒëŸ¬ í‚¤ë¥¼ ìƒì„±í•´ì•¼í•œë‹¤.


      4-1-1. â€˜1-4â€™ ì—ì„œ í™•ë³´í•œ ë…¸ì…˜í† í°ì„ â€˜NOTION_TOKENâ€™ìœ¼ë¡œ ì €ì¥í•œë‹¤.


      4-1-2. â€˜2-3â€™ ì—ì„œ í™•ë³´í•œ DB IDë¥¼ â€˜DATABASE_IDâ€™ ë¡œ ì €ì¥í•œë‹¤.


      4-1-2. â€˜ê¹ƒí—ˆë¸Œ personalKeyâ€™ë¥¼ â€˜GH_TOKENâ€™ ìœ¼ë¡œ ì €ì¥í•œë‹¤. 


![8](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/8.png)


   4-2. root í´ë”ì— â€˜_scriptsâ€™ í´ë”ë¥¼ ìƒì„±í•˜ê³ , ìƒì„±í•œ í´ë” ì•ˆì— â€˜**notion-import.js**â€™ íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ ë‚´ìš©ì„ ì…ë ¥í•œë‹¤.


{% raw %}
```
javascript
const { Client } = require("@notionhq/client");
const { NotionToMarkdown } = require("notion-to-md");
const moment = require("moment");
const path = require("path");
const fs = require("fs");
const axios = require("axios");

const notion = new Client({
  auth: process.env.NOTION_TOKEN,
});

function escapeCodeBlock(body) {
  const regex = /
```
{% endraw %}([\s\S]*?){% raw %}
```
/g
  return body.replace(regex, function (match, htmlBlock) {
    return "{% raw %}\n
```
{% endraw %}\n" + htmlBlock + "\n{% raw %}
```
\n{% endraw %}";
  })
}

function replaceTitleOutsideRawBlocks(body) {
  const rawBlocks = [];
  const placeholder = "{% raw %}[\s\S]*?{% endraw %}";
  body = body.replace(/{% raw %}
```
json
{
    "devDependencies": {
        "@notionhq/client": "^1.0.4",
        "@types/node-fetch": "^2.6.2",
        "moment": "^2.29.2",
        "node-fetch": "^2.6.7",
        "notion-to-md": "^2.5.5",
        "axios": "^1.4.0"
    }
}

```
{% endraw %}/g, (match) => {
    rawBlocks.push(match);
    return placeholder;
  });

  const regex = /\n#[^\n]+\n/g;
  body = body.replace(regex, function (match) {
    return "\n" + match.replace("\n#", "\n##");
  });

  rawBlocks.forEach(block => {
    body = body.replace(placeholder, block);
  });

  return body;
}

// passing notion client to the option
const n2m = new NotionToMarkdown({ notionClient: notion });

(async () => {
  // ensure directory exists
  const root = "_posts";
  fs.mkdirSync(root, { recursive: true });

  const databaseId = process.env.DATABASE_ID;
  let response = await notion.databases.query({
    database_id: databaseId,
    filter: {
      property: "ë°°í¬",
      checkbox: {
        equals: true,
      },
    },
  });

  const pages = response.results;
  while (response.has_more) {
    const nextCursor = response.next_cursor;
    response = await notion.databases.query({
      database_id: databaseId,
      start_cursor: nextCursor,
      filter: {
        property: "ë°°í¬",
        checkbox: {
          equals: true,
        },
      },
    });
    pages.push(...response.results);
  }

  for (const r of pages) {
    const id = r.id;
    // date
    let date = moment(r.created_time).format("YYYY-MM-DD");
    let pdate = r.properties?.["ë‚ ì§œ"]?.["date"]?.["start"];
    if (pdate) {
      date = moment(pdate).format("YYYY-MM-DD");
    }
    // title
    let title = id;
    let ptitle = r.properties?.["ê²Œì‹œë¬¼"]?.["title"];
    if (ptitle?.length > 0) {
      title = ptitle[0]?.["plain_text"];
    }
    // tags
    let tags = [];
    let ptags = r.properties?.["íƒœê·¸"]?.["multi_select"];
    for (const t of ptags) {
      const n = t?.["name"];
      if (n) {
        tags.push(n);
      }
    }
    // categories
    let cats = [];
    let pcats = r.properties?.["ì¹´í…Œê³ ë¦¬"]?.["multi_select"];
    for (const t of pcats) {
      const n = t?.["name"];
      if (n) {
        cats.push(n);
      }
    } 
    // frontmatter
    let fmtags = "";
    let fmcats = "";
    let fmassrtmnt = "";
    if (tags.length > 0) {
      fmtags += "[";
      for (const t of tags) {
        fmtags += t + ", ";
      }
      fmtags += "]";
    }

    if (assrtmnt.length > 0) {
      fmassrtmnt += "[";
      for (const t of assrtmnt) {
        fmassrtmnt += t ;
      }
      fmassrtmnt += "]";
    }
    const fm = `---
title: "${title}"
excerpt: ""
header: ""

categories:
    - ${fmcats}
tags:
    - ${fmtags}
last_modified_at: ${date}
---
<br><br>
`;
    const mdblocks = await n2m.pageToMarkdown(id);
    let body = n2m.toMarkdownString(mdblocks)["parent"];
    if (body === "") {
      continue;
    }
    body = escapeCodeBlock(body);
    body = replaceTitleOutsideRawBlocks(body);

    const ftitle = `${date}-${title.replaceAll(" ", "_")}.md`;

    let index = 0;
    let edited_md = body.replace(
      /!\[(.*?)\]\((.*?)\)/g,
      function (match, p1, p2, p3) {
        // const dirname = path.join("assets/img", ftitle);
        const dirname = path.join("upload", ftitle);
        if (!fs.existsSync(dirname)) {
          fs.mkdirSync(dirname, { recursive: true });
        }
        const filename = path.join(dirname, `${index}.png`);

        axios({
          method: "get",
          url: p2,
          responseType: "stream",
        })
          .then(function (response) {
            let file = fs.createWriteStream(`${filename}`);
            response.data.pipe(file);
          })
          .catch(function (error) {
            console.log(error);
          });

        let res;
        if (p1 === "") res = "";
        else res = `_${p1}_`;

        return `![9](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/9.png)_${index++}_${res}`;
      }
    );

    //writing to file
    fs.writeFile(path.join(root, ftitle), fm + edited_md, (err) => {
      if (err) {
        console.log(err);
      }
    });
  }
})();

```
{% endraw %}


   4-3. ìœ„ JavaScript íŒŒì¼(**notion-import.js**)ì— ëŒ€í•œ dependencies ì„¤ì •ì„ ìœ„í•´ â€˜package.jsonâ€™íŒŒì¼ í•˜ë‹¨ì— ì•„ë˜ ë‚´ìš©ì„ ì…ë ¥ í•´ ì¤€ë‹¤.


{% raw %}
```
yaml
name: "Build and Deploy"
on:
  repository_dispatch:
    types: [RUN_WORKFLOW_DISPATCH]
      
permissions:
  contents: write
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  importer:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@master      
      - uses: actions/setup-node@v3
        with:
          node-version: "17"

      - run: npm install

      - run: node _scripts/notion-import.js
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          DATABASE_ID: ${{ secrets.DATABASE_ID }}

      - uses: stefanzweifel/git-auto-commit-action@v4
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        with:
          commit_message: "[BOT] Commit & Deploy from Notion"
          branch: main
          commit_user_name: morimin-bot ğŸ¤–
          commit_user_email: morimin@github.com
          commit_author: morimin-bot ğŸ¤– <morimin@github.com>
 
  build:
    needs: importer
    runs-on: ubuntu-latest

    steps:           
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: main
          fetch-depth: 1

      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v1

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1' # reads from a '.ruby-version' or '.tools-version' file if 'ruby-version' is omitted
          bundler-cache: true

      - name: Build site
        run: bundle exec jekyll b -d "_site${{ steps.pages.outputs.base_path }}"
        env:
          JEKYLL_ENV: "production"

      - name: Test site
        run: |
          bundle exec htmlproofer _site --disable-external --check-html --allow_hash_href

      - name: Upload site artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: "_site${{ steps.pages.outputs.base_path }}"

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1

```
{% endraw %}


   4-4. root í´ë”ì— â€˜.githubâ€™ í´ë”ë¥¼ ìƒì„±í•˜ê³ , ìƒì„±í•œ í´ë” ì•ˆì— â€˜workflowsâ€™ í´ë”ë¥¼ ìƒì„±í•˜ê³ , ìƒì„±í•œ í´ë” ì•ˆì— â€˜pages-deploy.ymlâ€™ íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ ë‚´ìš©ì„ ì…ë ¥í•œë‹¤.


{% raw %}
```
html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    .trigger-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .trigger-button {
      display: inline-block;
      margin-bottom: 10px;
      padding: 10px 20px;
      background-color: #4c9aff;
      color: white;
      font-size: 16px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s;
    }

    .trigger-button:hover {
      background-color: #2e86ff;
    }

    .message {
      font-size: 16px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="trigger-container">
    <button id="triggerButton" class="trigger-button">UPLOAD</button>
    <div id="message" class="message"></div>
  </div>

  <script>
  document.getElementById("triggerButton").addEventListener("click", function() {
    var messageElement = document.getElementById("message");
    messageElement.textContent = "ìš”ì²­ ì „ì†¡ ì¤‘...";

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "https://api.github.com/repos/USERNAME/REPO_NAME/dispatches", true);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3+json");
    xhr.setRequestHeader("Authorization", "Bearer GITHUB_ACCESS_TOKEN");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onload = function() {
      if (xhr.status === 204) {
        messageElement.textContent = "ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤." + xhr.status;
      } else {
        messageElement.textContent = "ìš”ì²­ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ìƒíƒœ ì½”ë“œ: " + xhr.status;
      }
    };

    xhr.onerror = function() {
      messageElement.textContent = "ìš”ì²­ ì „ì†¡ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
    };

    xhr.send(JSON.stringify({"event_type": "RUN_WORKFLOW_DISPATCH"}));
  });
</script>
</body>
</html>

```
{% endraw %}


   4-5. ë°°í¬ë²„íŠ¼ì„ ë§Œë“¤ê¸° ìœ„í•´, ì•„ë˜ ë§í¬ ì¤‘ ë³¸ì¸ì˜ ë‚´ìš©ì— ë§ê²Œ ìˆ˜ì •(ì•„ë˜ í•˜ì´ë¼ì´íŠ¸ ë¶€ë¶„)í•œë‹¤.


%%RAW_BLOCK%%


   4-6. ë°°í¬ ë²„íŠ¼ì„ ë§í¬ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì•„ë˜HTMLë¸”ë¡ìƒì„± ë§í¬ë¡œ ì ‘ì†í•œë‹¤.


[https://www.notion-tools.com/embeds/html](https://www.notion-tools.com/embeds/html)


![10](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/10.png)


   4-7. ìœ„ â€˜4-5â€™ì—ì„œ ë§Œë“  ì½”ë“œë¥¼ ë„£ê³  ë§í¬ë¥¼ ìƒì„±í•œë‹¤.


![11](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/11.png)


   4-8. ë…¸ì…˜ì—ì„œ /embed ë¥¼ ê²€ìƒ‰í•´ì„œ ì„ë² ë“œ ë¸”ë¡ì„ ìƒì„±í•œë‹¤.


![12](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/12.png)


   4-9. ìœ„ â€˜4-7â€™ì—ì„œ ìƒì„±í•œ ë§í¬ë¥¼ ì„ë² ë“œ í•´ì¤€ë‹¤.


![13](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/13.png)


   4-10. ìƒì„±ëœ ë°°í¬ ë²„íŠ¼(ì„ë² ë””ë“œëœ ë§í¬)


![14](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/14.png)


   4-11. ì—…ë¡œë“œ ë²„íŠ¼ì„ ëˆŒë¥´ë©´, ê¹ƒì•¡ì…˜ì„ í†µí•´ ë´‡ìœ¼ë¡œ ë°°í¬ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


![15](/upload/2024-07-17-ë…¸ì…˜_ê¹ƒí—ˆë¸Œ_ë¸”ë¡œê·¸_ìë™_ì—°ë™í•˜ê¸°.md/15.png)


NotionBlog DB

